<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Admin Dashboard - Samiha Zeineddine Life Coach" />
  <title>Admin Dashboard - Samiha Zeineddine</title>

  <!-- GLOBAL & ADMIN CSS -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/admin-dashboard.css">

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- COGNITO LIB -->
  <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6/dist/amazon-cognito-identity.min.js"></script>
  <script src="js/cognito-config.js"></script>

</head>

<body>

<!-- ==============================
     1Ô∏è‚É£ ADMIN ACCESS PROTECTION
=============================== -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const session = await CognitoAuth.getCurrentSession();

    // Not logged in ‚Üí LOGIN PAGE
    if (!session) {
        window.location.href = "login.html";
        return;
    }

    const token = session.session.getIdToken().payload;
    const groups = token["cognito:groups"] || [];

    // Logged in but NOT admin ‚Üí USER dashboard
    if (!groups.includes("Admin")) {
        window.location.href = "user-dashboard.html";
        return;
    }

    // LOAD ADMIN PROFILE
    const user = session.user;
    user.getUserAttributes((err, attrs) => {
        let name = "";
        let email = "";

        attrs.forEach(a => {
            if (a.getName() === "name") name = a.getValue();
            if (a.getName() === "email") email = a.getValue();
        });

        if (!name) name = email.split("@")[0];
        document.getElementById("adminUserName").textContent = name;
    });
});
</script>

<!-- ==============================
     MAIN ADMIN LAYOUT
=============================== -->
<div class="admin-layout">

  <!-- SIDEBAR -->
  <aside class="admin-sidebar">
    <h2 data-i18n="adminPanel">‚öôÔ∏è Admin Panel</h2>

    <ul class="admin-nav">
      <li><a class="nav-link active" onclick="switchAdminSection(event, 'dashboard')" data-i18n="dashboard">üìä Dashboard</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'users')" data-i18n="users">üë• Users</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'questions')" data-i18n="questions">‚ùì Questions</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'tests')" data-i18n="tests">üìù Tests</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'courses')" data-i18n="courses">üìö Courses</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'responses')" data-i18n="responses">üí¨ Responses</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'payments')" data-i18n="payments">üí≥ Payments</a></li>
      <li><a class="nav-link" onclick="switchAdminSection(event, 'analytics')" data-i18n="analytics">üìà Analytics</a></li>
    </ul>

  </aside>


  <!-- MAIN CONTENT AREA -->
  <div class="admin-main">

    <!-- HEADER -->
    <div class="admin-header">
      <h1 data-i18n="adminDashboard">Admin Dashboard</h1>

      <div>
        <span id="adminUserName" style="font-weight:bold;">Loading...</span>
        <a href="index.html" style="text-decoration:none; color:#8B7355;" data-i18n="home">Home</a>
        <button class="logout" onclick="adminLogout()" data-i18n="logout">Logout</button>
      </div>
    </div>

    <!-- ==========================
         CONTENT SECTIONS
    ============================== -->
    <div class="admin-content">

      <!-- DASHBOARD SECTION -->
      <section id="dashboard" class="admin-section active">
        <h2 class="section-title" data-i18n="dashboardOverview">Dashboard Overview</h2>

        <div class="stats-grid">
          <div class="stat-box">
            <h3 data-i18n="totalUsers">Total Users</h3>
            <div class="number">0</div>
          </div>
          <div class="stat-box">
            <h3 data-i18n="activeSessions">Active Sessions</h3>
            <div class="number">0</div>
          </div>
          <div class="stat-box">
            <h3 data-i18n="pendingQuestions">Pending Questions</h3>
            <div class="number">0</div>
          </div>
          <div class="stat-box">
            <h3 data-i18n="totalRevenue">Total Revenue</h3>
            <div class="number">$0</div>
          </div>
        </div>

        <div class="table-container">
          <h3 data-i18n="recentActivity">Recent Activity</h3>
          <table class="admin-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Activity</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="recentActivityBody"></tbody>
          </table>
        </div>

      </section>


      <!-- USERS SECTION -->
      <section id="users" class="admin-section">
        <h2 class="section-title" data-i18n="userManagement">User Management</h2>

        <div class="admin-tabs">
          <button class="admin-tab-btn active" onclick="switchTab(event, 'users-list')" data-i18n="allUsers">All Users</button>
          <button class="admin-tab-btn" onclick="switchTab(event, 'add-user')" data-i18n="addUser">Add User</button>
        </div>

        <div id="users-list" class="tab-content active">
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Joined</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody"></tbody>
            </table>
          </div>
        </div>

        <div id="add-user" class="tab-content">
          <div class="form-section">
            <h3 data-i18n="createNewUser">Create New User</h3>

            <div class="form-row">
              <div class="form-group">
                <label>Full Name</label>
                <input type="text" placeholder="Full Name">
              </div>
              <div class="form-group">
                <label>Email Address</label>
                <input type="email" placeholder="user@example.com">
              </div>
            </div>

            <div class="form-group">
              <label>Password</label>
              <input type="password" placeholder="Set password">
            </div>

            <button class="btn-submit" onclick="alert('User creation API coming soon')">Add User</button>
          </div>
        </div>

      </section>


      <!-- QUESTIONS SECTION -->
      <section id="questions" class="admin-section">
        <h2 class="section-title">Manage Questions</h2>
      <!-- QUESTIONS FOR SAMIHA (ADMIN) -->
<section id="admin-questions" class="content-section">
  <div class="results-header">
    <h2>Questions for Samiha</h2>
    <p>Users‚Äô submitted questions</p>
  </div>

  <div id="questionsStatus" style="margin-bottom:10px;color:#666;"></div>

  <div id="questionsList" style="display:flex;flex-direction:column;gap:12px;"></div>
</section>

     </section>
        


      <div style="margin-top:40px;">
        <h3 class="section-title">Users Who Took Tests</h3>
      
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Test Name</th>
                <th>Diagnosis</th>
                <th>Completed At</th>
              </tr>
            </thead>
      
            <!-- THIS ID MUST EXIST -->
            <tbody id="usersTestsTableBody"></tbody>
          </table>
        </div>
      </div>
      
    </section>
      <!-- COURSES SECTION -->
      <section id="courses" class="admin-section">
        <h2 class="section-title">Manage Courses</h2>

        <div class="admin-tabs">
          <button class="admin-tab-btn active" onclick="switchTab(event, 'courses-list')">All Courses</button>
          <button class="admin-tab-btn" onclick="switchTab(event, 'create-course')">Create Course</button>
        </div>

        <div id="courses-list" class="tab-content active">
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Course</th>
                  <th>Duration</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="coursesTableBody"></tbody>
            </table>
          </div>
        </div>

        <div id="create-course" class="tab-content">
          <div class="form-section">
            <h3>Create New Course</h3>

            <div class="form-group">
              <label>Course Name</label>
              <input type="text" placeholder="Course name">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Duration (weeks)</label>
                <input type="number" placeholder="8">
              </div>
              <div class="form-group">
                <label>Price ($)</label>
                <input type="number" placeholder="499">
              </div>
            </div>

            <div class="form-group">
              <label>Description</label>
              <textarea placeholder="Describe the course..."></textarea>
            </div>

            <button class="btn-submit">Create Course</button>
          </div>
        </div>

      </section>


      <!-- PAYMENTS SECTION -->
      <section id="payments" class="admin-section">
        <h2 class="section-title">Payments & Revenue</h2>

        <div class="stats-grid">
          <div class="stat-box">
            <h3>Total Revenue</h3>
            <div class="number">$0</div>
          </div>

          <div class="stat-box">
            <h3>This Month</h3>
            <div class="number">$0</div>
          </div>
        </div>

        <div class="table-container">
          <h3>Recent Transactions</h3>

          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>User</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="transactionsTableBody"></tbody>
          </table>
        </div>

      </section>


      <!-- ANALYTICS SECTION -->
      <section id="analytics" class="admin-section">
        <h2 class="section-title">Analytics</h2>

        <div class="stats-grid">
          <div class="stat-box">
            <h3>Total Page Views</h3>
            <div class="number">0</div>
          </div>
          <div class="stat-box">
            <h3>Avg Session Duration</h3>
            <div class="number">0m</div>
          </div>
        </div>

        <div class="table-container">
          <h3>Engagement</h3>

          <table class="admin-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Tests Taken</th>
                <th>Courses</th>
                <th>Last Active</th>
              </tr>
            </thead>
            <tbody id="analyticsTableBody"></tbody>
          </table>
        </div>
      </section>

    </div> <!-- END admin-content -->
  </div> <!-- END admin-main -->
</div> <!-- END admin-layout -->


<!-- ==========================
     TRANSLATION SYSTEM
=========================== -->
<script>
const adminTranslations = {
  en: {
    adminPanel: "‚öôÔ∏è Admin Panel",
    dashboard: "üìä Dashboard",
    users: "üë• Users",
    questions: "‚ùì Questions",
    tests: "üìù Tests",
    courses: "üìö Courses",
    responses: "üí¨ Responses",
    payments: "üí≥ Payments",
    analytics: "üìà Analytics",
    adminDashboard: "Admin Dashboard",
    home: "Home",
    logout: "Logout",
    dashboardOverview: "Dashboard Overview",
    totalUsers: "Total Users",
    activeSessions: "Active Sessions",
    pendingQuestions: "Pending Questions",
    totalRevenue: "Total Revenue",
    recentActivity: "Recent Activity",
    userManagement: "User Management",
    allUsers: "All Users",
    addUser: "Add User",
    createNewUser: "Create New User"
  },

  ar: {
    adminPanel: "‚öôÔ∏è ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ",
    dashboard: "üìä ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©",
    users: "üë• ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ",
    questions: "‚ùì ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©",
    tests: "üìù ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™",
    courses: "üìö ÿßŸÑÿØŸàÿ±ÿßÿ™",
    responses: "üí¨ ÿßŸÑÿ±ÿØŸàÿØ",
    payments: "üí≥ ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™",
    analytics: "üìà ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™",
    adminDashboard: "ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ",
    home: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
    logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
    dashboardOverview: "ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©",
    totalUsers: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ",
    activeSessions: "ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©",
    pendingQuestions: "ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖÿπŸÑŸÇÿ©",
    totalRevenue: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™",
    recentActivity: "ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿÆŸäÿ±",
    userManagement: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ",
    allUsers: "ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ",
    addUser: "ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ",
    createNewUser: "ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ"
  },

  fr: {
    adminPanel: "‚öôÔ∏è Panneau Admin",
    dashboard: "üìä Tableau de bord",
    users: "üë• Utilisateurs",
    questions: "‚ùì Questions",
    tests: "üìù Tests",
    courses: "üìö Cours",
    responses: "üí¨ R√©ponses",
    payments: "üí≥ Paiements",
    analytics: "üìà Analyses",
    adminDashboard: "Tableau de bord admin",
    home: "Accueil",
    logout: "D√©connexion",
    dashboardOverview: "Aper√ßu g√©n√©ral",
    totalUsers: "Total des utilisateurs",
    activeSessions: "Sessions actives",
    pendingQuestions: "Questions en attente",
    totalRevenue: "Revenu total",
    recentActivity: "Activit√© r√©cente",
    userManagement: "Gestion des utilisateurs",
    allUsers: "Tous les utilisateurs",
    addUser: "Ajouter utilisateur",
    createNewUser: "Cr√©er un utilisateur"
  }
};

function applyAdminLang(lang) {
  const dict = adminTranslations[lang] || adminTranslations.en;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    el.textContent = dict[el.getAttribute("data-i18n")];
  });

  if (lang === "ar") {
      document.documentElement.dir = "rtl";
      document.body.classList.add("rtl");
  } else {
      document.documentElement.dir = "ltr";
      document.body.classList.remove("rtl");
  }
}

document.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem("adminLang") || "en";
    applyAdminLang(saved);
});
</script>


<!-- ==========================
     NAVIGATION / LOGOUT LOGIC
=========================== -->
<script>
function switchAdminSection(e, id) {
  document.querySelectorAll(".nav-link").forEach(n =>
    n.classList.remove("active")
  );
  e.target.classList.add("active");

  document.querySelectorAll(".admin-section").forEach(s =>
    s.classList.remove("active")
  );
  document.getElementById(id).classList.add("active");

  // üëá LOAD USERS WHEN USERS SECTION OPENS
  if (id === "users") {
    loadUsers();
  }
}


function switchTab(e, id) {
  document.querySelectorAll(".admin-tab-btn").forEach(t => t.classList.remove("active"));
  e.target.classList.add("active");

  document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function adminLogout() {
  const user = getCurrentUser();
  if (user) user.signOut();
  window.location.href = "login.html";
}
</script>
<script src="js/admin-config.js"></script>
<script src="js/admin-api.js"></script>
<script src="js/admin-users.js"></script>
<script src="js/admin-questions-samiha.js"></script>
<script src="js/admin-tests-users.js"></script>



</body>
</html>
